#!/usr/bin/env bash
set -e
MAIN_EXECUTABLE="$HOME/.local/share/dotinstall/dotinstall"

if ! command -v brew &> /dev/null; then
  echo "Error: Homebrew is not installed. Please install it first." >&2
  exit 1
fi
if ! command -v mise &> /dev/null; then
  echo "mise not found. Installing with Homebrew..."
  brew install mise
fi

if [ "$1" = "--update" ] || [ ! -f "$MAIN_EXECUTABLE" ]; then
  echo "Downloading dotinstall..."
  curl -L -o "$MAIN_EXECUTABLE" https://api-minio.zh.vanill.eu/p-lucas-dotinstall-bdacf8c8/latest/dotinstall_generic.js
  chmod +x "$MAIN_EXECUTABLE"
  if [ "$1" = "--update" ]; then
    echo "dotinstall has been updated successfully."
    exit 0
  fi
fi

${MAIN_EXECUTABLE} $@
