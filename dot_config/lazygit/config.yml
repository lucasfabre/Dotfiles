customCommands:
  - key: <c-a>
    description: 'AI Commit: Choose format'
    command: |
      bash -c '
        # Step 1: Prompt the user to choose the commit message format.
        FORMAT=$(printf "Conventional Commits\nOpenCommit" | fzf --prompt="Select commit format: " --height=20% --border --cycle)

        # Exit if the user pressed Esc or did not select a format.
        if [ -z "$FORMAT" ]; then
            echo "No format selected. Commit aborted."
            exit 0
        fi

        # Step 2: Capture the staged git diff and recent commit history.
        # These variables will be available to the script we source in the next step.
        GIT_DIFF=$(git diff --cached)
        GIT_LOG=$(git log -n 10 --pretty=format:"%h %s")

        # Step 3: Source the appropriate prompt script based on user selection using a case statement.
        # This will load the prompt content into the PROMPT variable.
        case "$FORMAT" in
          "Conventional Commits")
            source "$HOME/.config/lazygit/conventional_commit.sh"
            ;;
          "OpenCommit")
            source "$HOME/.config/lazygit/opencommit.sh"
            ;;
        esac

        # Step 4: Execute the original workflow using the PROMPT variable from the sourced script.
        mods --raw -f "$PROMPT" 2>/dev/null \
          | fzf --height 40% --border --ansi --prompt="Select your commit message: " --preview "echo {}" --preview-window=up:wrap \
          | xargs -I {} bash -c '\''
              COMMIT_MSG_FILE=$(mktemp)
              echo "{}" > "$COMMIT_MSG_FILE"
              ${EDITOR:-vim} "$COMMIT_MSG_FILE"
              if [ -s "$COMMIT_MSG_FILE" ]; then
                  git commit -F "$COMMIT_MSG_FILE"
              else
                  echo "Commit message is empty, commit aborted."
              fi
              rm -f "$COMMIT_MSG_FILE"'\''
      '
    context: 'files'
    output: 'terminal'

